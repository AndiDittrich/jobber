<!DOCTYPE html>
<html lang="en">

<head>
<meta charset='utf-8' />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description"
  content="Jobber: An alternative to cron, with sophisticated status-reporting and error-handling." />

<link rel="stylesheet"
  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
  integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
  crossorigin="anonymous" />

<link rel="stylesheet" href="/jobber/stylesheets/app.css" />

<script src="https://use.fontawesome.com/9c63186c95.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"
  type="text/javascript"></script>

<script
  src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
  integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
  crossorigin="anonymous" type="text/javascript"></script>
<link rel="stylesheet" href="/jobber/stylesheets/doc.css" />
<script src="/jobber/scripts/doc.js"></script>

<title>How to Use Jobber</title>

<script lang="test/javascript">
	g_curr_version = "1.2";

	function onLoad() {
		// make version selector
		$("header h1 small").append(makeVersionsSelect(g_curr_version));
	}
</script>
</head>

<body onload="onLoad()" data-spy="scroll" data-target="#toc-container"
  data-offset="100">

  <!-- NAV BAR -->
        <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar-collapse"
              aria-expanded="false">
              <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span>
              <span class="icon-bar"></span> <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/jobber/">Jobber</a>
          </div>
          <div class="collapse navbar-collapse" id="navbar-collapse">
            <ul class="nav navbar-nav">
            <li><a href="/jobber/download/">
                    Download                  </a>
                </li>
                <li class="active"><a href="/jobber/doc/v1.2/">
                    How to Use                  </a>
                </li>
                <li><a href="/jobber/security/">
                    Security                  </a>
                </li>
                <li><a href="/jobber/blog/">
                    Blog                  </a>
                </li>
                            </ul>
          </div>
        </div>
      </nav>
    
  <header class="container">
    <h1>
      How to Use Jobber <br /> <small>Version </small>
    </h1>
  </header>

  <!-- MAIN CONTENT -->
  <div id="main-container" class="container">
    <div class="row">

      <div class="col-md-3">
        <div id="toc-container" class="hidden-sm hidden-xs hidden-print"
          data-spy="affix" data-offset-top="150">
          <nav class="nav internal-nav">
            <ul class="nav-list-1">
              <li>
                <a class="top-nav-item nobr" href="#" target="_self">How
                  to Use</a>
                <ul class="nav-list-2">
                          <li class="nobr">
          <a target="_self" href="#deployment">
            Deployment          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#defining-jobs">
            Defining Jobs          </a>
        <ul class="nav-list-3">                <li class="nobr">
                  <a target="_self" href="#overview">
                    Overview                  </a>
                </li>
                                <li class="nobr">
                  <a target="_self" href="#section-prefs">
                    Preferences                  </a>
                </li>
                                <li class="nobr">
                  <a target="_self" href="#section-jobs">
                    Jobs                  </a>
                </li>
                                <li class="nobr">
                  <a target="_self" href="#error-handling">
                    Error-handling                  </a>
                </li>
                </ul></li>        <li class="nobr">
          <a target="_self" href="#loading-jobs">
            Loading Jobs          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#listing-jobs">
            Listing Jobs          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#listing-runs">
            Listing Runs          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#testing-jobs">
            Testing Jobs          </a>
        </li>                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <!-- col -->

      <section id="main-section" class="col-md-9 main" role="main">
        <div id="deployment"><section>
  <h2>Deployment</h2>

  <p itemprop="requirements">
    Jobber is written in <a href="https://golang.org/">Go</a>, and it should be
    possible to compile and run it on <span itemprop="operatingSystem">any
      Unix/Linux system</span>.
  </p>

  <p>Note that, although Jobber can be used instead of cron, it is certainly
    possible to run both at the same time.</p>

  <aside class="alert alert-warning">
    <h4 class="alert-heading">Warning</h4>
    Privilege-escalation is possible if the OS on which Jobber runs allows
    non-root users to change the owner of a file to another user. Fortunately,
    this is not possible in Linux and is not common in other kinds of Unix.
  </aside>

  <h3>Installation from a Package</h3>

  <p>
    The easiest way to install Jobber is via <a href="/jobber/download">a
      binary package</a>.
  </p>

  <h3>Compilation and Installation from Source</h3>

  <p>Instead of installing a binary package, you can certainly compile and
    install Jobber yourself.</p>

  <p>You need a recent version of Go to compile Jobber. So, install Go, pick
    a place for your workspace (say, /path/to/your/workspace), and ensure that
    the environment variable &ldquo;GOPATH&rdquo; includes a path to your
    workspace. Then:</p>

  <pre>cd /path/to/your/workspace
go get github.com/dshearer/jobber
cd src/github.com/dshearer/jobber
git checkout v1.2
make GO_WKSPC=/path/to/your/workspace</pre>

  <p>Jobber consists of two binaries: jobber and jobberd. jobberd is a
    daemon that runs jobs; jobber is a client with which the user can interact
    with jobbberd. After compiling, you&rsquo;ll find them in
    /path/to/your/workspace/bin.</p>

  <p>Now:</p>
  <ol>
    <li>Make a new, non-login user called &ldquo;jobber_client&rdquo;.</li>
    <li>Change jobber&rsquo;s permissions to 04755, and its owner to
      jobber_client:root.</li>
    <li>Change jobberd&rsquo;s permissions to 0755, and its owner to
      root:root.</li>
    <li>Move jobber and jobberd someplace more appropriate (e.g.,
      /usr/local/bin and /usr/local/libexec respectively).</li>
    <li>Ensure that jobberd will get started when your computer boots. Note
      that jobberd does not daemonize itself &mdash; you will need to run it
      with something like <a href="https://linux.die.net/man/1/daemonize">daemonize(1)</a>.
    </li>
  </ol>
</section></div>            <section id="defining-jobs">
              <h2>Defining Jobs</h2>
            <div id="overview"><p>
  As with cron, each user can have its own set of jobs, which will be run under
  that user&rsquo;s privileges. A user&rsquo;s jobs are defined in a
  <dfn>jobfile</dfn>
  &mdash; a file named &ldquo;.jobber&rdquo; in the user&rsquo;s home directory.
  Here's an example that defines two jobs:
</p>

<pre>[prefs]
  notifyProgram: /home/foobar/handleError.sh

[jobs]
- name: DailyBackup
  cmd: backup daily
  time: 0 0 13
  onError: Stop
  notifyOnError: true
  notifyOnFailure: false

- name: OffsiteBackup
  cmd: |
    mount /backup/offsite
    mount /backup/linux/weekly
    backup-offsite /backup/linux/weekly/backup-0 linux || exit 1
    umount /backup/linux/weekly
    umount /backup/offsite
  time: 0 0 14 * * 1
  onError: Stop</pre>

<p>
  As shown, there are two sections:
  <code>prefs</code>
  and
  <code>jobs</code>
  . The contents of both sections are <a href="http://www.yaml.org/">YAML</a>
  documents.
</p>

<aside>
  <p>
    If you&rsquo;re unfamiliar with YAML: The document in the
    <code>prefs</code>
    section contains a mapping with a single entry. The document in the
    <code>jobs</code>
    section contains a sequence of two mappings: the two line-initial dashes (
    <code>-</code>
    ) mark the beginnings of the two mappings. Within the definition of a
    particular map, each key (e.g.,
    <code>name</code>
    ,
    <code>cmd</code>
    ) must be column-aligned. The value for each key in the maps is a string. In
    this example, the value for the key
    <code>cmd</code>
    in the second map is a multi-line string.
  </p>
</aside></div><div id="section-prefs"><section>
  <h3>
    Section
    <code>prefs</code>
  </h3>

  <p>This section sets general preferences for how Jobber runs this
    user&rsquo;s jobs. At this time, there is only one valid field.</p>

  <table class="table">
    <thead>
      <tr>
        <th>Field</th>
        <th>Value</th>
        <th>Default Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>notifyProgram</code></td>
        <td>
          <p>A path to an executable file.</p>

          <p>
            When this field is set, jobs that notify on error or failure do so
            by executing the specified file. See <a href="#error-handling">below</a>
            for details.
          </p>

          <p>When it is not set, they notify by sending an email to the
            owning user, using sendmail.</p>
        </td>
        <td>None.</td>
      </tr>
    </tbody>
  </table>
</section></div><div id="section-jobs"><section>
  <h3>
    Section
    <code>jobs</code>
  </h3>

  <p>This section defines the user&rsquo;s jobs.</p>

  <p>As stated above, this section must contain a YAML file that defines a
    sequence of mappings. Each mapping in this sequence defines a job.</p>

  <p>The fields of a job definition:</p>
  <table class="table">
    <thead>
      <tr>
        <th>Field</th>
        <th>Value</th>
        <th>Default Value</th>
      </tr>
    </thead>
    <tfoot></tfoot>
    <tbody>
      <tr>
        <td><code>name</code></td>
        <td>The name of the job.</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td><code>cmd</code></td>
        <td>A shell script that is executed when this job runs. Jobber will
          use the shell at /bin/sh.</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td>A string specifying when the job should run. See <a
          href="#time-strings">below</a> for details.
        </td>
        <td><code>* * * * * *</code></td>
      </tr>
      <tr>
        <td><code>onError</code></td>
        <td>A string (<code>Stop</code>, <code>Backoff</code>, or <code>Continue</code>)
          specifying what should happen when the job has an error. See <a
          href="#error-handling">below</a> for details.
        </td>
        <td><code>Continue</code></td>
      </tr>
      <tr>
        <td><code>notifyOnError</code></td>
        <td>A string (<code>true</code> or <code>false</code>) specifying
          whether jobberd should notify when the job has an error. See <a
          href="#error-handling">below</a> for details.
        </td>
        <td><code>false</code></td>
      </tr>
      <tr>
        <td><code>notifyOnFailure</code></td>
        <td>A string (<code>true</code> or <code>false</code>) specifying
          whether jobberd should notify when the job fails. See <a
          href="#error-handling">below</a> for details.
        </td>
        <td><code>true</code></td>
      </tr>
    </tbody>
  </table>

  <h4 id="time-strings">Time Strings</h4>

  <p>
    Field
    <code>time</code>
    specifies the schedule at which a job is run, in a manner similar to how
    cron jobs&rsquo; schedules are specified: with a space-separated list of up
    to six specifiers, each one of which constrains a different component of
    time (second, minute, hour, etc.). Schematically:
  </p>

  <blockquote>
    <code>sec min hour month_day month week_day</code>
  </blockquote>

  <p>
    <strong>A job is scheduled thus:</strong> it will run at any time that
    satisfies all of the specifiers sec, min, hour, and month and one of the
    specifiers month_day and week_day.
  </p>

  <p>Each specifier can take one of the following forms: (&ldquo;a&rdquo;,
    &ldquo;b&rdquo;, &ldquo;c&rdquo;, and &ldquo;n&rdquo; are placeholders for
    arbitrary numerals.)</p>

  <table class="table">
    <thead>
      <tr>
        <th>Specifier Form</th>
        <th>What It Matches</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>*</code></td>
        <td>Any value</td>
      </tr>
      <tr>
        <td><code>a</code></td>
        <td>The value a</td>
      </tr>
      <tr>
        <td><code>*/n</code></td>
        <td>Every n-th value &mdash; e.g., <code>*/25</code> in the sec
          specifier would match 0, 25, and 50, whereas in the month specifier it
          would match 1 and 26.
        </td>
      </tr>
      <tr>
        <td><code>a,b,c,...</code></td>
        <td>The values a, b, c, ...</td>
      </tr>
      <tr>
        <td><code>a-b</code></td>
        <td>Any of the values between and including a and b</td>
      </tr>
    </tbody>
  </table>

  <p>The specifiers have different permitted values for the placeholders in
    the specifier forms:</p>

  <table class="table">
    <thead>
      <tr>
        <th>Specifier</th>
        <th>Values for &ldquo;a&rdquo;, &ldquo;b&rdquo;, and
          &ldquo;c&rdquo;</th>
        <th>Values for &ldquo;n&rdquo;</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>sec</td>
        <td><code>0</code> thru <code>59</code></td>
        <td><code>1</code> thru <code>59</code></td>
      </tr>
      <tr>
        <td>min</td>
        <td><code>0</code> thru <code>59</code></td>
        <td><code>1</code> thru <code>59</code></td>
      </tr>
      <tr>
        <td>hour</td>
        <td><code>0</code> thru <code>23</code></td>
        <td><code>1</code> thru <code>23</code></td>
      </tr>
      <tr>
        <td>month_day</td>
        <td><code>1</code> thru <code>31</code></td>
        <td><code>1</code> thru <code>30</code></td>
      </tr>
      <tr>
        <td>month</td>
        <td><code>1</code> thru <code>12</code></td>
        <td><code>1</code> thru <code>11</code></td>
      </tr>
      <tr>
        <td>week_day</td>
        <td><code>0</code> thru <code>6</code></td>
        <td><code>1</code> thru <code>5</code></td>
      </tr>
    </tbody>
  </table>

  <aside>
    <p>
      <strong>NOTE:</strong> Because in a YAML document
      <code>*</code>
      has a special meaning at the beginning of an item, if your time string
      starts with
      <code>*</code>
      you must quote the whole string, thus:
      <code>time: '*/10'</code>
    </p>
  </aside>
</section></div><div id="error-handling"><section>
  <h3>Error-handling</h3>

  <p>
    Some terms: When Jobber runs a job and that job exits with a non-0 status,
    we call that a <strong>job error</strong>. When Jobber stops scheduling runs
    of a job due to one or more job errors, we call that a <strong>job
      failure</strong>.
  </p>

  <p>
    In the
    <code>onError</code>
    field in the job&rsquo;s definition, you can control what Jobber does after
    a job error by picking one of these values:
  </p>

  <table class="table">
    <thead>
      <tr>
        <th>Value</th>
        <th>Effect</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>Stop</code></td>
        <td>Stop scheduling runs of this job.</td>
      </tr>
      <tr>
        <td><code>Backoff</code></td>
        <td>Schedule runs of this job according to an exponential backoff
          algorithm. If a later run of the job succeeds, jobber resumes
          scheduling this job normally; but if the job errors again on several
          consecutive runs, Jobber stops scheduling it.</td>
      </tr>
      <tr>
        <td><code>Continue</code></td>
        <td>Continue scheduling this job normally.</td>
      </tr>
    </tbody>
  </table>

  <p>
    If you would like Jobber to notify you when a job errors or fails, first set
    <code>notifyOnError</code>
    or
    <code>notifyOnFailure</code>
    to
    <code>true</code>
    in the job&rsquo;s definition in the Jobber file.
  </p>

  <p>
    Then, write a <em>notify program</em> &mdash; a program that does whatever
    logic you want done after an error or failure. Set the
    <code>notifyProgram</code>
    field in the
    <code>prefs</code>
    section of the Jobber file to the path to your notify program.
  </p>

  <p>When Jobber calls your notify program, it will write to stdin a JSON
    document like this:</p>

  <pre>{  
   "job":{  
      "command":"/home/dylan/some_program",
      "name":"MyHourlyJob",
      "notifyOnError":true,
      "notifyOnFailure":false,
      "onError":"Stop",
      "status":"Failed",
      "time":"0 0 * * * *"
   },
   "startTime":"May 29 15:25:10 2017",
   "stderr":"Some errors\n",
   "stderr_base64":false,
   "stdout":"Quotes: \"adf\"\n",
   "stdout_base64":false,
   "succeeded":false,
   "user":"dylan"
}</pre>

  <p>
    The fields in the
    <code>job</code>
    object are from the job&rsquo;s definition, except for
    <code>status</code>
    , which contains
    <code>Good</code>
    ,
    <code>Backoff</code>
    , or
    <code>Failed</code>
    .
  </p>

  <p>
    <code>stdout</code>
    (respectively,
    <code>stderr</code>
    ) contains whatever the job wrote to stdout (stderr). If
    <code>stdout_base64</code>
    contains
    <code>true</code>
    , then the job wrote only UTF-8 bytes to stdout (stderr), and
    <code>stdout</code>
    (
    <code>stderr</code>
    ) contains a string with those bytes; otherwise, there were some non-UTF-8
    bytes and
    <code>stdout</code>
    (
    <code>stderr</code>
    ) contains a Base64 encoding of the output.
  </p>
</section></div></section><div id="loading-jobs"><section>
  <h2>Loading Jobs</h2>

  <p>After you've created a user&rsquo;s jobfile, log in as that user and
    do:</p>

  <pre>jobber reload</pre>

  <p>You can also reload all users&rsquo; jobfiles by logging in as root and
    doing:</p>

  <pre>jobber reload -a</pre>
</section></div><div id="listing-jobs"><section>
  <h2>Listing Jobs</h2>

  <p>You can list the jobs for a particular user by logging in as that user
    and doing</p>

  <pre>jobber list</pre>

  <p>This command also shows you the status of each job &mdash; that is,
    whether the job is being scheduled as normal, the exponential backoff
    algorithm is being applied, or the job has failed.</p>

  <p>
    As with the
    <code>reload</code>
    command, you can do the same for all users by adding the
    <code>-a</code>
    option as root.
  </p>
</section></div><div id="listing-runs"><section>
  <h2>Listing Runs</h2>

  <p>You can see a list of recent runs of any jobs for a particular user by
    logging in as that user and doing</p>

  <pre>jobber log</pre>

  <p>
    As with the other commands, you can do the same for all users by adding the
    <code>-a</code>
    option as root.
  </p>
</section></div><div id="testing-jobs"><section>
  <h2>Testing Jobs</h2>

  <p>If you'd like to test out a job, do</p>

  <pre>jobber test JOB_NAME</pre>

  <p>Jobber will immediately run that job, tell you whether it succeeded,
    and show you its output.</p>
</section></div>      </section>
    </div>
  </div>
  <!-- main content -->
</body>

</html>
