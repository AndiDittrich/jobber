<!DOCTYPE html>
<html lang="en">

<head>
<meta charset='utf-8' />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description"
  content="Jobber: An alternative to cron, with sophisticated status-reporting and error-handling." />

<link rel="stylesheet"
  href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
  integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
  crossorigin="anonymous" />

<link rel="stylesheet" href="/jobber/stylesheets/app.css" />

<script src="https://use.fontawesome.com/9c63186c95.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"
  type="text/javascript"></script>

<script
  src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
  integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
  crossorigin="anonymous" type="text/javascript"></script>
<link rel="stylesheet" href="/jobber/stylesheets/doc.css" />
<script src="/jobber/scripts/doc.js"></script>

<title>How to Use Jobber</title>

<script lang="test/javascript">
	  function onLoad() {
		// reset version selector
    var select = $("header h1 small select");
		var opt = select.find("option[selected]")[0];
    select.val(opt.value);
	}
  </script>
</head>

<body onload="onLoad()" data-spy="scroll" data-target="#toc-container"
  data-offset="100">

  <!-- NAV BAR -->
        <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
              data-toggle="collapse" data-target="#navbar-collapse"
              aria-expanded="false">
              <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span>
              <span class="icon-bar"></span> <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/jobber/">Jobber</a>
          </div>
          <div class="collapse navbar-collapse" id="navbar-collapse">
            <ul class="nav navbar-nav">
            <li><a href="/jobber/download/">
                    Download                  </a>
                </li>
                <li class="active"><a href="/jobber/doc/v1.4/">
                    How to Use                  </a>
                </li>
                <li><a href="/jobber/security/">
                    Security                  </a>
                </li>
                <li><a href="/jobber/blog/">
                    Blog                  </a>
                </li>
                            </ul>
          </div>
        </div>
      </nav>
    
  <header class="container">
    <h1>
      How to Use Jobber <br /> <small>Version
        <select onchange="var ver = event.target.value; if (ver == '1.1') { return; } window.location.pathname = '/jobber/doc/v' + ver + '/';"><option value="1.4"  >1.4</option><option value="1.3"  >1.3</option><option value="1.2"  >1.2</option><option value="1.1" selected >1.1</option></select></small>
    </h1>
  </header>

  <!-- MAIN CONTENT -->
  <div id="main-container" class="container">
    <div class="row">

      <div class="col-md-3">
        <div id="toc-container" class="hidden-sm hidden-xs hidden-print"
          data-spy="affix" data-offset-top="150">
          <nav class="nav internal-nav">
            <ul class="nav-list-1">
              <li class="top-nav-item nobr" target="_self"><a href="#">How
                  to Use</a></li>
              <li>
                <ul class="nav-list-2">
                          <li class="nobr">
          <a target="_self" href="#deployment">
            Deployment          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#defining-jobs">
            Defining Jobs          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#loading-jobs">
            Loading Jobs          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#listing-jobs">
            Listing Jobs          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#listing-runs">
            Listing Runs          </a>
        </li>        <li class="nobr">
          <a target="_self" href="#testing-jobs">
            Testing Jobs          </a>
        </li>                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <!-- col -->

      <section id="main-section" class="col-md-9 main" role="main">
        <div id="deployment"><section>
  <h2>Deployment</h2>

  <p itemprop="requirements">
    Jobber is written in <a href="https://golang.org/">Go</a>, and it should be
    possible to compile and run it on <span itemprop="operatingSystem">any
      Linux system</span>. We currently provide
    <a href="https://dshearer.github.io/jobber/download/">binary packages</a>
    for RHEL-like systems, Ubuntu/Debian and Alpine Linux.
  </p>

  <p>Note that, although Jobber can be used instead of cron, it is certainly
    possible to run both at the same time.</p>

  <aside class="alert alert-warning">
    <h4 class="alert-heading">Warning</h4>
    Privilege-escalation is possible if the OS on which Jobber runs allows
    non-root users to change the owner of a file to another user. Fortunately,
    this is not possible in Linux and is not common in other kinds of Unix.
  </aside>

  <h3>Compilation and Installation from Source</h3>

  <p>You need a recent version of Go to compile Jobber. So, install Go, pick
    a place for your workspace (say, /path/to/your/workspace), and ensure that
    the environment variable &ldquo;GOPATH&rdquo; includes a path to your
    workspace. Then:</p>

  <pre>cd /path/to/your/workspace
go get github.com/dshearer/jobber
cd src/github.com/dshearer/jobber
git checkout v1.1
make GO_WKSPC=/path/to/your/workspace</pre>

  <p>Jobber consists of two binaries: jobber and jobberd. jobberd is a
    daemon that runs jobs; jobber is a client with which the user can interact
    with jobbberd. After compiling, you&rsquo;ll find them in
    /path/to/your/workspace/bin.</p>

  <p>Now:</p>
  <ol>
    <li>Make a new, non-login user called &ldquo;jobber_client&rdquo;.</li>
    <li>Change jobber&rsquo;s permissions to 04755, and its owner to
      jobber_client:root.</li>
    <li>Change jobberd&rsquo;s permissions to 0755, and its owner to
      root:root.</li>
    <li>Move jobber and jobberd someplace more appropriate (e.g.,
      /usr/local/bin and /usr/local/libexec respectively).</li>
    <li>Ensure that jobberd will get started when your computer boots. Note
      that jobberd does not daemonize itself &mdash; you will need to run it
      with something like <a href="https://linux.die.net/man/1/daemonize">daemonize(1)</a>.
    </li>
  </ol>
</section>
</div><div id="defining-jobs"><section>
  <h2>Defining Jobs</h2>

  <p>
    As with cron, each user can have its own set of jobs, which will be run
    under that user&rsquo;s privileges. A user&rsquo;s jobs are defined in a
    <dfn>jobfile</dfn>
    &mdash; a file named &ldquo;.jobber&rdquo; in the user&rsquo;s home
    directory. Jobfiles are written in <a href="http://www.yaml.org/">YAML</a>
    format. Here's an example that defines two jobs:
  </p>

  <pre>---
- name: DailyBackup
  cmd: backup daily
  time: 0 0 13
  onError: Stop
  notifyOnError: true
  notifyOnFailure: false

- name: OffsiteBackup
  cmd: |
    mount /backup/offsite
    mount /backup/linux/weekly
    backup-offsite /backup/linux/weekly/backup-0 linux || exit 1
    umount /backup/linux/weekly
    umount /backup/offsite
  time: 0 0 14 * * 1
  onError: Stop</pre>

  <aside>
    <p>
      If you&rsquo;re unfamiliar with YAML: The first line in the example (
      <code>---</code>
      ) marks the beginning of the YAML document. The document contains a list
      of maps: the two line-initial dashes (
      <code>-</code>
      ) mark the beginnings of the two maps. Within the definition of a
      particular map, each key (e.g.,
      <code>name</code>
      ,
      <code>cmd</code>
      ) must be column-aligned. The value for each key in the maps is a string.
      In this example, the value for the key
      <code>cmd</code>
      in the second map is a multi-line string.
    </p>
  </aside>

  <p>The fields of a job definition:</p>
  <table class="table">
    <thead>
      <tr>
        <th>Field</th>
        <th>Contents</th>
        <th>Default Value</th>
      </tr>
    </thead>
    <tfoot></tfoot>
    <tbody>
      <tr>
        <td><code>name</code></td>
        <td>The name of the job.</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td><code>cmd</code></td>
        <td>A Bash script that is executed when this job runs.</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td>A string specifying when the job should run. See <a
          href="#time-strings">below</a> for details.
        </td>
        <td><code>* * * * * *</code></td>
      </tr>
      <tr>
        <td><code>onError</code></td>
        <td>A string specifying what should happen when the job has an
          error. See <a href="#error-handling">below</a> for details.
        </td>
        <td><code>Continue</code></td>
      </tr>
      <tr>
        <td><code>notifyOnError</code></td>
        <td>A string (<code>true</code> or <code>false</code>) specifying
          whether jobberd should send an email when the job has an error. See <a
          href="#error-handling">below</a> for details.
        </td>
        <td><code>false</code></td>
      </tr>
      <tr>
        <td><code>notifyOnFailure</code></td>
        <td>A string (<code>true</code> or <code>false</code>) specifying
          whether jobberd should send an email when the job fails. See <a
          href="#error-handling">below</a> for details.
        </td>
        <td><code>true</code></td>
      </tr>
    </tbody>
  </table>

  <h4 id="time-strings">Time Strings</h4>

  <p>
    Field
    <code>time</code>
    specifies the schedule at which a job is run, in a manner similar to how
    cron jobs&rsquo; schedules are specified: with a space-separated list of up
    to six specifiers. Each specifier describes a constraint on a &ldquo;time
    component&rdquo; &mdash; e.g., second, minute &mdash; that must hold in
    order for the job to run at a particular time. In order from left to right,
    these are the time components corresponding to the specifiers:
  </p>
  <ol>
    <li>second</li>
    <li>minute</li>
    <li>hour</li>
    <li>day of month</li>
    <li>month</li>
    <li>day of week</li>
  </ol>

  <p>
    <code>*</code>
    as a specifier is a wildcard &mdash; it is satisfied by every value of the
    corresponding time component. If any specifiers are missing, they are
    assumed to be
    <code>*</code>
    .
  </p>

  <p>Specific values are specified with numbers: 0&ndash;59 for second and
    minute, 0&ndash;23 for hour, 1&ndash;31 for day of month, 1&ndash;12 for
    month, and 0&ndash;6 for day of week (with 0 specifying Sunday).</p>

  <p>
    A specifier of the form
    <code>*/n</code>
    is satisfied by every nth value &mdash; e.g.,
    <code>*/3</code>
    as the second specifier is satisfied by minute 0, minute 3, minute 6, etc.
  </p>

  <p>A job will run at the earliest future time that satisfies the first,
    second, third, and fifth specifiers and at least one of the fourth and sixth
    specifiers.</p>

  <p>Thus, &ldquo;DailyBackup&rdquo; is run whenever the current time is
    13:00:00 (i.e., 1 PM), no matter the day, whereas
    &ldquo;OffsiteBackup&rdquo; is run whenever the current time is 14:00:00
    (i.e., 2 PM) and the current weekday is Monday.</p>

  <aside>
    <p>
      Because in a YAML document
      <code>*</code>
      has a special meaning at the beginning of an item, if your time string
      starts with
      <code>*</code>
      you must quote the whole string, thus:
      <code>time: '*/10'</code>
    </p>
  </aside>

  <h4 id="error-handling">Error-handling</h4>

  <p>
    When discussing jobs, by &ldquo;job error&rdquo; we mean the failure of a
    particular run of a job, whereas by &ldquo;job failure&rdquo; we mean a job
    that jobber has decided not to schedule anymore due to one or more recent
    job errors. Jobber considers a run to have failed when the command (in field
    <code>cmd</code>
    ) returns a non-0 exit status.
  </p>

  <p>
    Field
    <code>onError</code>
    ; specifies what jobber will do when a job error occurs. The possible
    values:
  </p>

  <ul>
    <li><code>Stop</code>: <em>Stop scheduling runs of this job.</em> That
      is, a single job error results in a job failure.</li>
    <li><code>Backoff</code>: <em>Schedule runs of this job according
        to an exponential backoff algorithm.</em> If a later run of the job succeeds,
      jobber resumes scheduling this job normally; but if the job fails again on
      several consecutive runs, jobber stops scheduling it &mdash; that is, the
      job fails.</li>
    <li><code>Continue</code>: <em>Continue scheduling this job
        normally.</em> That is, the job will never fail.</li>
  </ul>
</section>
</div><div id="loading-jobs"><section>
  <h2>Loading Jobs</h2>

  <p>After you've created a user&rsquo;s jobfile, log in as that user and
    do:</p>

  <pre>jobber reload</pre>

  <p>You can also reload all users&rsquo; jobfiles by logging in as root and
    doing:</p>

  <pre>jobber reload -a</pre>
</section></div><div id="listing-jobs"><section>
  <h2>Listing Jobs</h2>

  <p>You can list the jobs for a particular user by logging in as that user
    and doing</p>

  <pre>jobber list</pre>

  <p>This command also shows you the status of each job &mdash; that is,
    whether the job is being scheduled as normal, the exponential backoff
    algorithm is being applied, or the job has failed.</p>

  <p>
    As with the
    <code>reload</code>
    command, you can do the same for all users by adding the
    <code>-a</code>
    option as root.
  </p>
</section></div><div id="listing-runs"><section>
  <h2>Listing Runs</h2>

  <p>You can see a list of recent runs of any jobs for a particular user by
    logging in as that user and doing</p>

  <pre>jobber log</pre>

  <p>
    As with the other commands, you can do the same for all users by adding the
    <code>-a</code>
    option as root.
  </p>
</section></div><div id="testing-jobs"><section>
  <h2>Testing Jobs</h2>

  <p>If you'd like to test out a job, do</p>

  <pre>jobber test JOB_NAME</pre>

  <p>Jobber will immediately run that job, tell you whether it succeeded,
    and show you its output.</p>
</section></div>      </section>
    </div>
  </div>
  <!-- main content -->
</body>

</html>
