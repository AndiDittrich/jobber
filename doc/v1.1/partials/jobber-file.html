<section>
  <h3>Defining Jobs</h3>

  <p>
    As with cron, each user can have its own set of jobs, which will be run
    under that user&rsquo;s privileges. A user&rsquo;s jobs are defined in a
    <dfn>jobfile</dfn>
    &mdash; a file named &ldquo;.jobber&rdquo; in the user&rsquo;s home
    directory. Jobfiles are written in <a href="http://www.yaml.org/">YAML</a>
    format. Here's an example that defines two jobs:
  </p>

  <pre>---
- name: DailyBackup
  cmd: backup daily
  time: 0 0 13
  onError: Stop
  notifyOnError: true
  notifyOnFailure: false

- name: OffsiteBackup
  cmd: |
    mount /backup/offsite
    mount /backup/linux/weekly
    backup-offsite /backup/linux/weekly/backup-0 linux || exit 1
    umount /backup/linux/weekly
    umount /backup/offsite
  time: 0 0 14 * * 1
  onError: Stop</pre>

  <aside>
    <p>
      If you&rsquo;re unfamiliar with YAML: The first line in the example (
      <code>---</code>
      ) marks the beginning of the YAML document. The document contains a list
      of maps: the two line-initial dashes (
      <code>-</code>
      ) mark the beginnings of the two maps. Within the definition of a
      particular map, each key (e.g.,
      <code>name</code>
      ,
      <code>cmd</code>
      ) must be column-aligned. The value for each key in the maps is a string.
      In this example, the value for the key
      <code>cmd</code>
      in the second map is a multi-line string.
    </p>
  </aside>

  <p>The fields of a job definition:</p>
  <table class="table">
    <thead>
      <tr>
        <th>Field</th>
        <th>Contents</th>
        <th>Default Value</th>
      </tr>
    </thead>
    <tfoot></tfoot>
    <tbody>
      <tr>
        <td><code>name</code></td>
        <td>The name of the job.</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td><code>cmd</code></td>
        <td>A Bash script that is executed when this job runs.</td>
        <td>N/A</td>
      </tr>
      <tr>
        <td><code>time</code></td>
        <td>A string specifying when the job should run. See <a
          href="#time-strings">below</a> for details.
        </td>
        <td><code>* * * * * *</code></td>
      </tr>
      <tr>
        <td><code>onError</code></td>
        <td>A string specifying what should happen when the job has an
          error. See <a href="#error-handling">below</a> for details.
        </td>
        <td><code>Continue</code></td>
      </tr>
      <tr>
        <td><code>notifyOnError</code></td>
        <td>A string (<code>true</code> or <code>false</code>) specifying
          whether jobberd should send an email when the job has an error. See <a
          href="#error-handling">below</a> for details.
        </td>
        <td><code>false</code></td>
      </tr>
      <tr>
        <td><code>notifyOnFailure</code></td>
        <td>A string (<code>true</code> or <code>false</code>) specifying
          whether jobberd should send an email when the job fails. See <a
          href="#error-handling">below</a> for details.
        </td>
        <td><code>true</code></td>
      </tr>
    </tbody>
  </table>

  <h4 id="time-strings">Time Strings</h4>

  <p>
    Field
    <code>time</code>
    specifies the schedule at which a job is run, in a manner similar to how
    cron jobs&rsquo; schedules are specified: with a space-separated list of up
    to six specifiers. Each specifier describes a constraint on a &ldquo;time
    component&rdquo; &mdash; e.g., second, minute &mdash; that must hold in
    order for the job to run at a particular time. In order from left to right,
    these are the time components corresponding to the specifiers:
  </p>
  <ol>
    <li>second</li>
    <li>minute</li>
    <li>hour</li>
    <li>day of month</li>
    <li>month</li>
    <li>day of week</li>
  </ol>

  <p>
    <code>*</code>
    as a specifier is a wildcard &mdash; it is satisfied by every value of the
    corresponding time component. If any specifiers are missing, they are
    assumed to be
    <code>*</code>
    .
  </p>

  <p>Specific values are specified with numbers: 0&ndash;59 for second and
    minute, 0&ndash;23 for hour, 1&ndash;31 for day of month, 1&ndash;12 for
    month, and 0&ndash;6 for day of week (with 0 specifying Sunday).</p>

  <p>
    A specifier of the form
    <code>*/n</code>
    is satisfied by every nth value &mdash; e.g.,
    <code>*/3</code>
    as the second specifier is satisfied by minute 0, minute 3, minute 6, etc.
  </p>

  <p>A job will run at the earliest future time that satisfies the first,
    second, third, and fifth specifiers and at least one of the fourth and sixth
    specifiers.</p>

  <p>Thus, &ldquo;DailyBackup&rdquo; is run whenever the current time is
    13:00:00 (i.e., 1 PM), no matter the day, whereas
    &ldquo;OffsiteBackup&rdquo; is run whenever the current time is 14:00:00
    (i.e., 2 PM) and the current weekday is Monday.</p>

  <aside>
    <p>
      Because in a YAML document
      <code>*</code>
      has a special meaning at the beginning of an item, if your time string
      starts with
      <code>*</code>
      you must quote the whole string, thus:
      <code>time: '*/10'</code>
    </p>
  </aside>

  <h4 id="error-handling">Error-handling</h4>

  <p>
    When discussing jobs, by &ldquo;job error&rdquo; we mean the failure of a
    particular run of a job, whereas by &ldquo;job failure&rdquo; we mean a job
    that jobber has decided not to schedule anymore due to one or more recent
    job errors. Jobber considers a run to have failed when the command (in field
    <code>cmd</code>
    ) returns a non-0 exit status.
  </p>

  <p>
    Field
    <code>onError</code>
    ; specifies what jobber will do when a job error occurs. The possible
    values:
  </p>

  <ul>
    <li><code>Stop</code>: <em>Stop scheduling runs of this job.</em> That
      is, a single job error results in a job failure.</li>
    <li><code>Backoff</code>: <em>Schedule runs of this job according
        to an exponential backoff algorithm.</em> If a later run of the job succeeds,
      jobber resumes scheduling this job normally; but if the job fails again on
      several consecutive runs, jobber stops scheduling it &mdash; that is, the
      job fails.</li>
    <li><code>Continue</code>: <em>Continue scheduling this job
        normally.</em> That is, the job will never fail.</li>
  </ul>
</section>
